---
date: 2021-11-08 16:40:44
title: 操作剪贴板
tags:
  - 功能实现
---

## 复制内容到剪贴板

```js
function setClipboarData(data) {
  let oInput = document.createElement("input");
  oInput.value = data;
  document.body.appendChild(oInput);
  oInput.select();
  document.execCommand("Copy");
  oInput.style.display = "none";
  document.body.removeChild(oInput);
}
```

## 获取剪贴板内容

```js
/** 获取剪贴板内容 */
function getClipboard() {
  document.addEventListener(
    "paste",
    async (e) => {
      const cbd = e.clipboardData;
      const ua = window.navigator.userAgent;
      // 如果是 Safari 直接 return
      if (!(e.clipboardData && e.clipboardData.items)) {
        return;
      }
      // Mac平台下Chrome49版本以下 复制Finder中的文件的Bug Hack掉
      if (
        cbd.items &&
        cbd.items.length === 2 &&
        cbd.items[0].kind === "string" &&
        cbd.items[1].kind === "file" &&
        cbd.types &&
        cbd.types.length === 2 &&
        cbd.types[0] === "text/plain" &&
        cbd.types[1] === "Files" &&
        ua.match(/Macintosh/i) &&
        Number(ua.match(/Chrome\/(\d{2})/i)[1]) < 49
      ) {
        return;
      }
      let blob: File;
      for (let i = 0; i < cbd.items.length; i++) {
        const item = cbd.items[i];
        if (item.kind === "file") {
          blob = item.getAsFile();
          if (blob) {
            this.sendMessage(blob);
          }
          if (blob.size === 0) {
            return;
          }
        }
      }
      return blob;
    },
    false
  );
}
```
