---
date: 2021-09-09 14:51:24
title: 【小程序】启动和更新机制
tags:
  - 小程序
---

## 启动机制

小程序启动会有两种情况，一种是「冷启动」，一种是「热启动」。

- 热启动：假如用户已经打开过某小程序，然后在一定时间内再次打开该小程序，此时无需重新启动，只需将后台态的小程序切换到前台，这个过程就是热启动；
- 冷启动：用户首次打开或小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启动，即冷启动。

小程序没有重启的概念。

## 更新机制

在发布小程序之后，小程序是一个热更新机制，会定时 check 是否有新版本，异步下载最新代码并进行版本替换，通常在 24 小时 内进行全部的版本替换。

- 未启动时更新

  开发者在管理后台发布新版本的小程序之后，如果某个用户本地有小程序的历史版本，此时打开的可能还是旧版本。微信客户端会有若干个时机去检查本地缓存的小程序有没有更新版本，如果有则会静默更新到新版本。总的来说，开发者在后台发布新版本之后，无法立刻影响到所有现网用户，但最差情况下，也在发布之后 24 小时之内下发新版本信息到用户。用户下次打开时会先更新最新版本再打开。

- 启动时更新

  小程序每次冷启动时，都会检查是否有更新版本，如果发现有新版本，将会异步下载新版本的代码包，并同时用客户端本地的包进行启动，即新版本的小程序需要等下一次冷启动才会应用上。

如果需要马上应用最新版本，可以使用 wx.getUpdateManager API 进行处理。

## 参考

[小程序的架构和原理](https://blog.csdn.net/qq_35534823/article/details/98121588)
