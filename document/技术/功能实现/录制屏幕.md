<author-info date="1629962298644"></author-info>

# 录制视频

## 思路

1. 用 navigator.mediaDevices.getDisplayMedia 获取到录制权限后得到 MediaStream。
2. 用 new MediaRecorder(MediaStream) 创建一个媒体录制的容器。
3. 使用 MediaRecorder 的 API 完成录制后保存数据（blob 格式）。
4. 用 URL.createObjectURL(blob) 创建 blob 链接，然后利用 a 标签实现下载。

## 代码实现

```js
var mediaRecorder;
var blobData;
function getMediaAuth() {
  // 获取录制权限
  navigator.mediaDevices
    .getDisplayMedia()
    .then((res) => {
      var options = { mimeType: "video/webm; codecs=vp9" };
      mediaRecorder = new MediaRecorder(res, options);
      startRecord();
      eventListenerStopRecord();
    })
    .catch((err) => {
      console.log(err);
    });
}
function eventListenerStopRecord() {
  // 录制停止时保存录制的blob数据
  mediaRecorder.ondataavailable = function (e) {
    blobData = e.data;
  };
}
function startRecord() {
  // 开始录制
  mediaRecorder.start();
}
function stopRecord() {
  // 停止录制
  mediaRecorder.stop();
}
function downLoad() {
  // 下载文件
  var url = URL.createObjectURL(blobData);
  var a = document.createElement("a");
  document.body.appendChild(a);
  a.style = "display: none";
  a.href = url;
  a.download = "screen-record.webm";
  a.click();
  window.URL.revokeObjectURL(url);
}
```
