# 媒体流

<author-info date="{docsify-updated}"> </author-info>

## MediaDevices

MediaDevices 接口提供访问连接媒体输入的设备，如照相机和麦克风，以及屏幕共享等。它可以使你取得任何硬件资源的媒体数据。

MediaDevices 的功能集成在 navigator.mediaDevices 中。

用 MediaDevices 成功获取授权时会得到一个 MediaStream，里面包含了请求的媒体类型的轨道。可以用 MediaRecorder 进行操作。

### 事件

#### devicechange

每当媒体设备（例如相机，麦克风或扬声器）连接到系统或从系统中移除时，devicechange 事件就会被发送到 MediaDevices 实例。

```js
navigator.mediaDevices.ondevicechange = function (event) {
  console.log(event);
};
```

### 方法

#### MediaDevices.enumerateDevices()

获取有关系统中可用的媒体输入和输出设备的一系列信息。

返回一个 promise，then 中包含设备信息。

```js
navigator.mediaDevices.enumerateDevices().then((res) => {
  console.log(res);
});
```

#### MediaDevices.getSupportedConstraints()

返回一个对象，该对象指明了 MediaStreamTrack 接口支持的可约束的属性。

```js
let SupportedConstraints = navigator.mediaDevices.getSupportedConstraints();
```

#### MediaDevices.getDisplayMedia()

提示用户选择显示器或显示器的一部分（例如窗口）以捕获为 MediaStream 以便共享或记录。返回解析为 MediaStream 的 Promise。

取消时触发 catch， 成功时 then 中包含一个 MediaStream。

```js
navigator.mediaDevices
  .getDisplayMedia()
  .then((res) => {
    console.log(res);
  })
  .catch((err) => {
    console.log(err);
  });
```

#### MediaDevices.getUserMedia(constraints)

**注意：此方法只能在 https 中使用，在 http 中会静默失败。**

在用户通过提示允许的情况下，打开系统上的相机或屏幕共享和/或麦克风，并提供 MediaStream 包含视频轨道和/或音频轨道的输入。

参数为一个对象，需要说明要请求的设备权限。

返回一个 promise，than 中包含一个 MediaStream。

```js
navigator.mediaDevices
  .getUserMedia({ video: true, audio: true })
  .then((res) => {
    console.log(res);
  })
  .catch((err) => {
    console.log(err);
  });
```
